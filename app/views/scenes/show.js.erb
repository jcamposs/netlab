var init = false;

try {
  <%= @module %>.getWidget();
} catch(err) {
  init = true;
  $('#dialog').html("<%=j render 'netwidget' %>");
  initWidget();
}

$('#dialog')
  .dialog({
    autoOpen: false,
    width: <%= @width %> + 30,
    height: <%= @height %> + 60,
    title: '<%= @scene.name %>',
    modal: true,
    open: function(event, ui) {
      var json =
      <% if @scene.definition %>
        "<%=j @scene.definition.html_safe %>";
      <% else %>
        "";
      <% end %>

      if (!init)
        loadStage(json);
    },
    close: function(event, ui) {
      clearScene();
    }
  });

$('#dialog').dialog('open');
