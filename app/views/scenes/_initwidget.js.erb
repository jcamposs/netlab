<%= javascript_tag do %>

  function clearScene() {
    var widget = <%= @module %>.getWidget();
    var nodes = widget.getNodes();

    for(var i = 0; i < nodes.length; i++)
      widget.removeNode(nodes[i].name);
  };

  function initStage() {
    var json =
      <% if @scene.definition %>
        "<%=j @scene.definition.html_safe %>";
      <% else %>
        "";
      <% end %>

    if (!json)
      return;

    var widget = <%= @module %>.getWidget();
    Netlab.loadJSON(widget, json);
  };

  function initWidget() {
    <%= @module %>.initWidget({
      container: "container",
      width: <%= @width %>,
      height: <%= @height %>,
      mode: "<%= @mode %>",
      callback: initStage
    });
  };

  $(window).load( function() {
    initWidget();
  });

<% end %>
